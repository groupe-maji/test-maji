<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>TEST PSYCHOTECHNIQUE MAJI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #timer { font-weight: bold; font-size: 1.2em; color: red; }
    #form-mail { display: none; }
    #result-message { font-size: 1.1em; color: green; margin-top: 20px; }
  </style>
</head>
<body>
  <div id="intro">
    <h1>TEST PSYCHOTECHNIQUE MAJI</h1>
    <p>Vous avez 20 secondes par question. Entrez votre nom, puis cliquez sur "Démarrer" pour commencer.</p>
    <input type="text" id="user-name" placeholder="Nom et prénom" style="margin-bottom:10px; width: 300px;"><br>
    <button id="start-button">Démarrer</button>
    <p id="name-error" style="color:red;"></p>
  </div>

  <div id="question-block" style="display:none">
    <h2 id="question"></h2>
    <div id="choices"></div>
    <button id="validate-button">Valider</button>
    <p id="feedback"></p>
    <p id="timer"></p>
  </div>

  <div id="result-message"></div>

  <script>
    window.onload = function () {
      emailjs.init("lvSCbMjI4S98izJHf"); // Votre user ID EmailJS

      const startButton = document.getElementById("start-button");
      const validateButton = document.getElementById("validate-button");

      startButton.addEventListener("click", startTest);
      validateButton.addEventListener("click", submitAnswer);

      const questionsMoyen = [
        { question: "Quel est le nombre suivant dans la série : 2, 4, 8, 16, ?", choices: ["18", "24", "32", "20", "30"], answer: "32" },
        { question: "Quel est l'intrus : cercle, carré, triangle, rectangle, cube ?", choices: ["cercle", "carré", "triangle", "rectangle", "cube"], answer: "cube" },
        { question: "Combien de côtés a un hexagone ?", choices: ["4", "5", "6", "7", "8"], answer: "6" },
        { question: "Quelle est la moyenne de ces nombres : 10, 20, 30, 40, 50 ?", choices: ["25", "30", "35", "40", "45"], answer: "30" },
        { question: "Quel mot est le plus différent des autres : couteau, fourchette, cuillère, assiette, verre ?", choices: ["couteau", "fourchette", "cuillère", "assiette", "verre"], answer: "assiette" },
        { question: "Quelle est la racine carrée de 144 ?", choices: ["10", "12", "14", "16", "18"], answer: "12" },
        { question: "Combien de côtés a un octogone ?", choices: ["6", "7", "8", "9", "10"], answer: "8" }
      ];

      const questionsDifficile = [
        { question: "Quel nombre complète la suite : 1, 4, 9, 16, 25, ?", choices: ["36", "30", "28", "32", "40"], answer: "36" },
        { question: "Combien y a-t-il de triangles dans un pentagone si on relie chaque sommet aux autres ?", choices: ["10", "20", "35", "25", "30"], answer: "35" },
        { question: "Si UN = 21, DEUX = 42, TROIS = ?", choices: ["63", "54", "51", "60", "66"], answer: "63" },
        { question: "Si les lettres A=1, B=2... combien vaut le mot MAJI ?", choices: ["34", "39", "42", "36", "33"], answer: "34" },
        { question: "Quel est le mot qui complète : mer, mère, maire, ?", choices: ["mire", "mari", "mare", "mirette", "mir"], answer: "mare" },
        { question: "Dans une horloge, combien de fois les aiguilles se superposent-elles en 12h ?", choices: ["11", "12", "22", "24", "10"], answer: "11" },
        { question: "Quel est le résultat de : (3 × 4) + (6 ÷ 2) ?", choices: ["15", "18", "12", "20", "14"], answer: "18" },
        { question: "Quel est le poids approximatif du cerveau humain adulte en grammes ?", choices: ["1200g", "1400g", "1600g", "1800g", "2000g"], answer: "1400g" }
      ];

      function getRandom(arr, n) {
        return arr.sort(() => 0.5 - Math.random()).slice(0, n);
      }

      let questions = [...getRandom(questionsMoyen, 7), ...getRandom(questionsDifficile, 8)];
      let index = 0;
      let score = 0;
      let timer;
      let countdown;
      const maxTime = 20;

      function startTest() {
        const name = document.getElementById("user-name").value.trim();
        if (!name) {
          document.getElementById("name-error").innerText = "Veuillez entrer votre nom.";
          return;
        }
        document.getElementById("name-error").innerText = "";
        document.getElementById("intro").style.display = "none";
        showQuestion();
      }

      function showQuestion() {
        if (index >= questions.length) {
          finishTest();
          return;
        }
        const current = questions[index];
        document.getElementById("question").innerText = current.question;
        document.getElementById("feedback").innerText = "";
        const choicesDiv = document.getElementById("choices");
        choicesDiv.innerHTML = "";

        current.choices.forEach((choice, i) => {
          const label = String.fromCharCode(65 + i);
          const radio = `<label><input type='radio' name='answer' value='${choice}'> (${label}) ${choice}</label><br>`;
          choicesDiv.innerHTML += radio;
        });

        document.getElementById("question-block").style.display = "block";
        startTimer();
      }

      function submitAnswer() {
        clearTimeout(timer);
        clearInterval(countdown);
        if (!questions[index]) {
          finishTest();
          return;
        }
        let userAnswer = document.querySelector('input[name="answer"]:checked')?.value || "";
        if (userAnswer.toLowerCase() === questions[index].answer.toLowerCase()) {
          score++;
          document.getElementById("feedback").innerText = "Correct !";
        } else {
          document.getElementById("feedback").innerText = "Faux. Réponse attendue : " + questions[index].answer;
        }
        index++;
        setTimeout(showQuestion, 1000);
      }

      function startTimer() {
        let timeLeft = maxTime;
        document.getElementById("timer").innerText = `Temps restant : ${timeLeft}s`;
        countdown = setInterval(() => {
          timeLeft--;
          document.getElementById("timer").innerText = `Temps restant : ${timeLeft}s`;
          if (timeLeft <= 0) {
            clearInterval(countdown);
          }
        }, 1000);
        timer = setTimeout(() => {
          if (!questions[index]) {
            finishTest();
            return;
          }
          document.getElementById("feedback").innerText = "Temps écoulé ! Réponse attendue : " + questions[index].answer;
          index++;
          setTimeout(showQuestion, 1000);
        }, maxTime * 1000);
      }

      function finishTest() {
        document.getElementById("question-block").style.display = "none";

        let profil = "";
        let qi = 100;
        if (score <= 5) {
          profil = "Profil logique faible, attention dispersée.";
          qi = 80;
        } else if (score <= 10) {
          profil = "Profil moyen, capacité de raisonnement correcte.";
          qi = 100;
        } else {
          profil = "Profil logique fort, excellente attention et mémoire.";
          qi = 120;
        }

        let nom = document.getElementById("user-name").value.trim();
        let message = {
          nom: nom,
          score: score,
          qi: qi,
          profil: profil
        };

        emailjs.send("service_37qqsvm", "template_y022b36", message)
          .then(function(response) {
            console.log("Email envoyé avec succès !", response.status, response.text);
          }, function(error) {
            console.error("Échec de l'envoi de l'email.", error);
          });

        document.getElementById("result-message").innerText = `Merci ${nom}, votre test est terminé. Score : ${score}/15. Vos résultats ont été transmis.`;
      }
    };
  </script>
</body>
</html>

